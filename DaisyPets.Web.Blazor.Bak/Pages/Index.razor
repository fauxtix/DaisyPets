@page "/"
@using DaisyPets.Core.Application.ViewModels;


<PageTitle>Index</PageTitle>

@code {
    [Inject] IConfiguration? config { get; set; }
    protected string? PetsApiEndpoint = string.Empty;
    protected IEnumerable<PetVM>? Pets { get; set; } = Enumerable.Empty<PetVM>();


    protected override async Task OnInitializedAsync()
    {
        PetsApiEndpoint = config["ApiSettings:UrlBase"];
        Pets = await GetAllPets();

    }

    private async Task<IEnumerable<PetVM>?> GetAllPets()
    {
        string url = $"{PetsApiEndpoint}/AllPetsVM";

        using (HttpClient httpClient = new HttpClient())
        {
            try
            {
                var response = await httpClient.GetFromJsonAsync<IEnumerable<PetVM>>(url);
                return response;
            }
            catch (Exception ex)
            {
                var msg = ex.Message;
                return Enumerable.Empty<PetVM>();
            }
        }
    }

}
